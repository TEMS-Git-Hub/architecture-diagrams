@startuml

box "Client Entity" 
    Participant "Client" as C
    Participant "Secure Token Service" as STS
    Participant "Wallet" as W
end box

Participant "DID Service" as DID
Participant "Trust Framework" as TF

box "Verifier Entity" 
    Participant "Verifier" as V
    Participant "Secure Token Service" as STSV
end box

W -> DID: Publish DID/Document

== Presentation Flow ==

C -> STS: Request Self Issued ID Token
STS -> C: ssid-token incl. Access Token
C -> V: Service Request w/ ssid-token incl. Access Token

V -> DID: Resolve DID
DID -> V: DID Document

V -> V:  Validate ssid-token
V -> TF: Validate client did

V -> STSV: Request Self Issued ID Token incl. same access token
STSV -> V: ssid-token (2nd) incl. verifier's DID and access token
V -> W: VP request w/ssid-token (2nd)
W -> W : Validate ssid-token
W -> W : Extract access token
W -> W: Validate VP request against access token
W -> V: VP response
V -> V: Validate VP
V -> TF: Validate VP
V -> S: Process Request

S -> V: Request response
V -> C: Request response

@enduml